<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Moving Beyond Linearity â€¢ StatisticalLearning</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">StatisticalLearning</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/03-LinearRegression.html">ISLR 3: Linear Regression</a>
    </li>
    <li>
      <a href="../articles/04-Classification.html">ISLR 4: Classification</a>
    </li>
    <li>
      <a href="../articles/05-CV-Resampling-Methods.html">ISLR 5: Resampling Methods</a>
    </li>
    <li>
      <a href="../articles/06-Model-Selection.html">ISLR 6: Linear Model Selection and Regularization</a>
    </li>
    <li>
      <a href="../articles/07-Nonlinear.html">Moving Beyond Linearity</a>
    </li>
    <li>
      <a href="../articles/08-Trees.html">Tree-Based Methods</a>
    </li>
    <li>
      <a href="../articles/09-SVM.html">Support Vector Machines</a>
    </li>
    <li>
      <a href="../articles/10-Unsupervised.html">Unsupervised Learning</a>
    </li>
    <li>
      <a href="../articles/quiz-05-CV-Resampling-Methods.html">ISLR: Bootstrap quiz</a>
    </li>
    <li>
      <a href="../articles/quiz-07-Nonlinear-Functions-in-R.html">ISLR: Nonlinear functions quiz</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Moving Beyond Linearity</h1>
            
          </div>

    
    
<div class="contents">

<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Here we explore the use of nonlinear models using some tools in R</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ISLR)
<span class="kw">attach</span>(Wage)</code></pre></div>
</div>
<div id="polynomials" class="section level2">
<h2 class="hasAnchor">
<a href="#polynomials" class="anchor"></a>Polynomials</h2>
<p>First we will use polynomials, and focus on a single predictor age:</p>
<p><span class="math display">\[ y_i = \beta_0 + \beta_1x_i + \beta_2x_i^2 + \beta_3x_i^3 +...+\beta_dx_i^d + \epsilon_i \]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wage_poly &lt;-<span class="st"> </span><span class="kw">lm</span>(wage <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(age, <span class="dv">4</span>), <span class="dt">data =</span> Wage)
<span class="kw">summary</span>(wage_poly)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = wage ~ poly(age, 4), data = Wage)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -98.707 -24.626  -4.993  15.217 203.693 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    111.7036     0.7287 153.283  &lt; 2e-16 ***
## poly(age, 4)1  447.0679    39.9148  11.201  &lt; 2e-16 ***
## poly(age, 4)2 -478.3158    39.9148 -11.983  &lt; 2e-16 ***
## poly(age, 4)3  125.5217    39.9148   3.145  0.00168 ** 
## poly(age, 4)4  -77.9112    39.9148  -1.952  0.05104 .  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 39.91 on 2995 degrees of freedom
## Multiple R-squared:  0.08626,    Adjusted R-squared:  0.08504 
## F-statistic: 70.69 on 4 and 2995 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>The <code>poly()</code> function generates a basis of <em>orthogonal polynomials</em> of the 4th order</p>
<p><span class="math display">\[ y_i = \hat\beta_0 + \hat\beta_1x_0 + \hat\beta_2x_0^2 + \hat\beta_3x_0^3 + \hat\beta_4x_0^4\]</span> Make a plot of the fitted polynomial function, along with the standard errors of the fit.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">range</span>(age)</code></pre></div>
<pre><code>## [1] 18 80</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">age_limits &lt;-<span class="st"> </span><span class="kw">range</span>(age)
age_grid &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> age_limits[<span class="dv">1</span>], <span class="dt">to =</span> age_limits[<span class="dv">2</span>])

wage_prediction &lt;-<span class="st"> </span><span class="kw">predict</span>(wage_poly, <span class="dt">newdata =</span> <span class="kw">list</span>(<span class="dt">age =</span> age_grid), <span class="dt">se =</span> <span class="ot">TRUE</span>)
error_bands &lt;-<span class="st"> </span><span class="kw">cbind</span>(wage_prediction<span class="op">$</span>fit <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>wage_prediction<span class="op">$</span>se, wage_prediction<span class="op">$</span>fit <span class="op">-</span><span class="st"> </span>
<span class="st">    </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>wage_prediction<span class="op">$</span>se)

<span class="kw">plot</span>(age, wage, <span class="dt">col =</span> <span class="st">"darkgrey"</span>)
<span class="kw">lines</span>(age_grid, wage_prediction<span class="op">$</span>fit, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">"blue"</span>)
<span class="kw">matlines</span>(age_grid, error_bands, <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="07-Nonlinear_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<p>There are other more direct ways of doing this. For example</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wage_poly_I &lt;-<span class="st"> </span><span class="kw">lm</span>(wage<span class="op">~</span>age<span class="op">+</span><span class="kw">I</span>(age<span class="op">^</span><span class="dv">2</span>)<span class="op">+</span><span class="kw">I</span>(age<span class="op">^</span><span class="dv">3</span>)<span class="op">+</span><span class="kw">I</span>(age<span class="op">^</span><span class="dv">4</span>), <span class="dt">data =</span> Wage)
<span class="kw">summary</span>(wage_poly_I)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = wage ~ age + I(age^2) + I(age^3) + I(age^4), data = Wage)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -98.707 -24.626  -4.993  15.217 203.693 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -1.842e+02  6.004e+01  -3.067 0.002180 ** 
## age          2.125e+01  5.887e+00   3.609 0.000312 ***
## I(age^2)    -5.639e-01  2.061e-01  -2.736 0.006261 ** 
## I(age^3)     6.811e-03  3.066e-03   2.221 0.026398 *  
## I(age^4)    -3.204e-05  1.641e-05  -1.952 0.051039 .  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 39.91 on 2995 degrees of freedom
## Multiple R-squared:  0.08626,    Adjusted R-squared:  0.08504 
## F-statistic: 70.69 on 4 and 2995 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Here <code>I()</code> is a <em>wrapper</em> function; we need it because <code>age^2</code> means something to the formula language, while <code>I(age^2)</code> is protected. The coefficients are different to those we got before! However, the fits are the same:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">fitted</span>(wage_poly), <span class="kw">fitted</span>(wage_poly_I))</code></pre></div>
<p><img src="07-Nonlinear_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<p>By using orthogonal polynomials in this simple way, we can separately test for each coefficient. So if we look at the summary again, we can see that the linear, quadratic and cubic terms are significant, but not the quartic.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(wage_poly)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = wage ~ poly(age, 4), data = Wage)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -98.707 -24.626  -4.993  15.217 203.693 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    111.7036     0.7287 153.283  &lt; 2e-16 ***
## poly(age, 4)1  447.0679    39.9148  11.201  &lt; 2e-16 ***
## poly(age, 4)2 -478.3158    39.9148 -11.983  &lt; 2e-16 ***
## poly(age, 4)3  125.5217    39.9148   3.145  0.00168 ** 
## poly(age, 4)4  -77.9112    39.9148  -1.952  0.05104 .  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 39.91 on 2995 degrees of freedom
## Multiple R-squared:  0.08626,    Adjusted R-squared:  0.08504 
## F-statistic: 70.69 on 4 and 2995 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>This only works with linear regression, and if there is a single predictor. In general we would use <code>anova()</code> as this next example demonstrates.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wage_ed &lt;-<span class="st"> </span><span class="kw">lm</span>(wage <span class="op">~</span><span class="st"> </span>education, <span class="dt">data =</span> Wage)

wage_ed_age &lt;-<span class="st"> </span><span class="kw">lm</span>(wage <span class="op">~</span><span class="st"> </span>education <span class="op">+</span><span class="st"> </span>age, <span class="dt">data =</span> Wage)

wage_ed_age2 &lt;-<span class="st"> </span><span class="kw">lm</span>(wage <span class="op">~</span><span class="st"> </span>education <span class="op">+</span><span class="st"> </span><span class="kw">poly</span>(age,<span class="dv">2</span>), <span class="dt">data =</span> Wage)

wage_ed_age3 &lt;-<span class="st"> </span><span class="kw">lm</span>(wage <span class="op">~</span><span class="st"> </span>education <span class="op">+</span><span class="st"> </span><span class="kw">poly</span>(age,<span class="dv">3</span>), <span class="dt">data =</span> Wage)

<span class="kw">anova</span>(wage_ed, wage_ed_age, wage_ed_age2, wage_ed_age3)</code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: wage ~ education
## Model 2: wage ~ education + age
## Model 3: wage ~ education + poly(age, 2)
## Model 4: wage ~ education + poly(age, 3)
##   Res.Df     RSS Df Sum of Sq        F Pr(&gt;F)    
## 1   2995 3995721                                 
## 2   2994 3867992  1    127729 102.7378 &lt;2e-16 ***
## 3   2993 3725395  1    142597 114.6969 &lt;2e-16 ***
## 4   2992 3719809  1      5587   4.4936 0.0341 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>

</div>
<div id="polynomial-logistic-regression" class="section level2">
<h2 class="hasAnchor">
<a href="#polynomial-logistic-regression" class="anchor"></a>Polynomial logistic regression</h2>
<p>Now we fit a logistic regression model to a binary response variable, constructed from <code>wage</code>. We code the big earners (<code>&gt;250K</code>) as 1, else 0.</p>
<p><span class="math display">\[Pr(y_i &gt; 250|x_i = \frac{exp(\beta_0 + \beta_1x_i + \beta_2x_i^2 +...+\beta_dx_i^d)}{1+exp(\beta_0 + \beta_1x_i + \beta_2x_i^2 +...+\beta_dx_i^d)} \]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">binary_wage &lt;-<span class="st"> </span><span class="kw">glm</span>(<span class="kw">I</span>(wage <span class="op">&gt;</span><span class="st"> </span><span class="dv">250</span>) <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(age, <span class="dv">3</span>), <span class="dt">data =</span> Wage, <span class="dt">family =</span> binomial)

<span class="kw">summary</span>(binary_wage)</code></pre></div>
<pre><code>## 
## Call:
## glm(formula = I(wage &gt; 250) ~ poly(age, 3), family = binomial, 
##     data = Wage)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -0.2808  -0.2736  -0.2487  -0.1758   3.2868  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    -3.8486     0.1597 -24.100  &lt; 2e-16 ***
## poly(age, 3)1  37.8846    11.4818   3.300 0.000968 ***
## poly(age, 3)2 -29.5129    10.5626  -2.794 0.005205 ** 
## poly(age, 3)3   9.7966     8.9990   1.089 0.276317    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 730.53  on 2999  degrees of freedom
## Residual deviance: 707.92  on 2996  degrees of freedom
## AIC: 715.92
## 
## Number of Fisher Scoring iterations: 8</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">binary_wage_prediction &lt;-<span class="st"> </span><span class="kw">predict</span>(binary_wage, <span class="kw">list</span>(<span class="dt">age =</span> age_grid), <span class="dt">se =</span> T)

binary_error_bands &lt;-<span class="st"> </span>binary_wage_prediction<span class="op">$</span>fit <span class="op">+</span><span class="st"> </span><span class="kw">cbind</span>(<span class="dt">fit =</span> <span class="dv">0</span>, <span class="dt">lower =</span> <span class="op">-</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>
<span class="st">    </span>binary_wage_prediction<span class="op">$</span>se, <span class="dt">upper =</span> <span class="dv">2</span> <span class="op">*</span><span class="st"> </span>binary_wage_prediction<span class="op">$</span>se)

binary_error_bands[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, ]</code></pre></div>
<pre><code>##          fit      lower     upper
## 1  -7.664756 -10.759826 -4.569686
## 2  -7.324776 -10.106699 -4.542852
## 3  -7.001732  -9.492821 -4.510643
## 4  -6.695229  -8.917158 -4.473300
## 5  -6.404868  -8.378691 -4.431045
## 6  -6.130251  -7.876426 -4.384076
## 7  -5.870980  -7.409397 -4.332563
## 8  -5.626658  -6.976672 -4.276644
## 9  -5.396887  -6.577351 -4.216423
## 10 -5.181269  -6.210574 -4.151964</code></pre>
<p>We have done the computations on the logit scale. To transform we need to apply the inverse logit mapping</p>
<p><span class="math display">\[p=\frac{e^\eta}{1+e^\eta}.\]</span></p>
<p>We can do this simultaneously for all three columns of <code>binary_error_bands</code>. The <code>matplot</code> function is useful.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">prob_error_bands &lt;-<span class="st"> </span><span class="kw">exp</span>(binary_error_bands)<span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(binary_error_bands))

<span class="kw">matplot</span>(age_grid, prob_error_bands, <span class="dt">col =</span> <span class="st">"purple"</span>, <span class="dt">lwd =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">lty =</span> <span class="kw">c</span>(<span class="dv">1</span>, 
    <span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">type =</span> <span class="st">"l"</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>))
<span class="kw">points</span>(<span class="kw">jitter</span>(age), <span class="kw">I</span>(wage <span class="op">&gt;</span><span class="st"> </span><span class="dv">250</span>)<span class="op">/</span><span class="dv">10</span>, <span class="dt">pch =</span> <span class="st">"|"</span>, <span class="dt">cex =</span> <span class="fl">0.5</span>)</code></pre></div>
<p><img src="07-Nonlinear_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>

</div>
<div id="splines" class="section level2">
<h2 class="hasAnchor">
<a href="#splines" class="anchor"></a>Splines</h2>
<p>Splines are more flexible than polynomials, but the idea is rather similar. Here we will explore cubic splines.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(splines)
wage_spline &lt;-<span class="st"> </span><span class="kw">lm</span>(wage <span class="op">~</span><span class="st"> </span><span class="kw">bs</span>(age, <span class="dt">knots =</span> <span class="kw">c</span>(<span class="dv">25</span>, <span class="dv">40</span>, <span class="dv">60</span>)), <span class="dt">data =</span> Wage)

<span class="kw">plot</span>(age, wage, <span class="dt">col =</span> <span class="st">"darkgrey"</span>)
<span class="kw">lines</span>(age_grid, <span class="kw">predict</span>(wage_spline, <span class="kw">list</span>(<span class="dt">age =</span> age_grid)), <span class="dt">col =</span> <span class="st">"brown"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)
<span class="kw">abline</span>(<span class="dt">v =</span> <span class="kw">c</span>(<span class="dv">25</span>, <span class="dv">40</span>, <span class="dv">60</span>), <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">"darkgreen"</span>)</code></pre></div>
<p><img src="07-Nonlinear_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<p>The smoothing splines does not require knot selection, but it does have a smoothing parameter, which can conveniently be specified via the effective degrees of freedom or <code>df</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wage_smooth &lt;-<span class="st"> </span><span class="kw">smooth.spline</span>(age, wage, <span class="dt">df =</span> <span class="dv">16</span>)
<span class="kw">plot</span>(age, wage, <span class="dt">col =</span> <span class="st">"darkgrey"</span>)
<span class="kw">lines</span>(wage_smooth, <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="07-Nonlinear_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<p>Or we can use LOO cross-validation to select the smoothing parameter for us automatically:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wage_smooth_cv &lt;-<span class="st"> </span><span class="kw">smooth.spline</span>(age, wage, <span class="dt">cv =</span> <span class="ot">TRUE</span>)
<span class="kw">plot</span>(age, wage, <span class="dt">col =</span> <span class="st">"darkgrey"</span>)
<span class="kw">lines</span>(wage_smooth_cv, <span class="dt">col =</span> <span class="st">"purple"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="07-Nonlinear_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wage_smooth_cv</code></pre></div>
<pre><code>## Call:
## smooth.spline(x = age, y = wage, cv = TRUE)
## 
## Smoothing Parameter  spar= 0.6988943  lambda= 0.02792303 (12 iterations)
## Equivalent Degrees of Freedom (Df): 6.794596
## Penalized Criterion (RSS): 75215.9
## PRESS(l.o.o. CV): 1593.383</code></pre>
</div>
<div id="generalized-additive-models" class="section level2">
<h2 class="hasAnchor">
<a href="#generalized-additive-models" class="anchor"></a>Generalized Additive Models</h2>
<p>So far we have focused on fitting models with mostly single nonlinear terms. The <code>gam</code> package makes it easier to work with multiple nonlinear terms. In addition it knows how to plot these functions and their standard errors.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(gam)</code></pre></div>
<pre><code>## Loading required package: foreach</code></pre>
<pre><code>## Loaded gam 1.14-4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wage_gam &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/gam/topics/gam">gam</a></span>(wage <span class="op">~</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/gam/topics/s">s</a></span>(age, <span class="dt">df =</span> <span class="dv">4</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/gam/topics/s">s</a></span>(year, <span class="dt">df =</span> <span class="dv">4</span>) <span class="op">+</span><span class="st"> </span>education, <span class="dt">data =</span> Wage)
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))
<span class="kw">plot</span>(wage_gam, <span class="dt">se =</span> T, <span class="dt">col =</span> <span class="st">"blue"</span>)</code></pre></div>
<p><img src="07-Nonlinear_files/figure-html/unnamed-chunk-14-1.png" width="960"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wage_gam2 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/gam/topics/gam">gam</a></span>(<span class="kw">I</span>(wage <span class="op">&gt;</span><span class="st"> </span><span class="dv">250</span>) <span class="op">~</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/gam/topics/s">s</a></span>(age, <span class="dt">df =</span> <span class="dv">4</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/gam/topics/s">s</a></span>(year, <span class="dt">df =</span> <span class="dv">4</span>) <span class="op">+</span><span class="st"> </span>education, 
    <span class="dt">data =</span> Wage, <span class="dt">family =</span> binomial)
<span class="kw">plot</span>(wage_gam2, <span class="dt">col =</span> <span class="st">"brown"</span>)</code></pre></div>
<p><img src="07-Nonlinear_files/figure-html/unnamed-chunk-15-1.png" width="960"><img src="07-Nonlinear_files/figure-html/unnamed-chunk-15-2.png" width="960"><img src="07-Nonlinear_files/figure-html/unnamed-chunk-15-3.png" width="960"></p>
<p>Lets see if we need a nonlinear terms for year</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wage_gam2a &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/gam/topics/gam">gam</a></span>(<span class="kw">I</span>(wage <span class="op">&gt;</span><span class="st"> </span><span class="dv">250</span>) <span class="op">~</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/gam/topics/s">s</a></span>(age, <span class="dt">df =</span> <span class="dv">4</span>) <span class="op">+</span><span class="st"> </span>year <span class="op">+</span><span class="st"> </span>education, <span class="dt">data =</span> Wage, 
    <span class="dt">family =</span> binomial)
<span class="kw">anova</span>(wage_gam2a, wage_gam2, <span class="dt">test =</span> <span class="st">"Chisq"</span>)</code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: I(wage &gt; 250) ~ s(age, df = 4) + year + education
## Model 2: I(wage &gt; 250) ~ s(age, df = 4) + s(year, df = 4) + education
##   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
## 1      2990     603.78                     
## 2      2987     602.87  3  0.90498   0.8242</code></pre>
<p>One nice feature of the <code>gam</code> package is that it knows how to plot the functions nicely, even for models fit by <code>lm</code> and <code>glm</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))
wage_lm &lt;-<span class="st"> </span><span class="kw">lm</span>(wage <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(age, <span class="dt">df=</span><span class="dv">4</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ns</span>(year, <span class="dt">df=</span><span class="dv">4</span>) <span class="op">+</span><span class="st"> </span>education, <span class="dt">data =</span> Wage)
<span class="kw"><a href="http://www.rdocumentation.org/packages/gam/topics/plot.gam">plot.gam</a></span>(wage_lm, <span class="dt">se =</span>T, <span class="dt">col=</span><span class="st">"blue"</span>)</code></pre></div>
<p><img src="07-Nonlinear_files/figure-html/unnamed-chunk-17-1.png" width="960"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#polynomials">Polynomials</a></li>
      <li><a href="#polynomial-logistic-regression">Polynomial logistic regression</a></li>
      <li><a href="#splines">Splines</a></li>
      <li><a href="#generalized-additive-models">Generalized Additive Models</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Justin M. Shea.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
